function makeusercheckbox(e,s,t,i){var r=$('<input type="checkbox" />');return r.prop("disabled",e),r.prop("checked",s[t]),r.click(function(e){var n=r.prop("checked");e.preventDefault(),confirm(`确定将${s.username}的'${i}'设为${n}吗?`)&&$.ajax({async:!0,url:"/web/user/info/"+s.userid+"/set",type:"POST",data:`{"${t}":${n}}`,success:function(e){"ok"!==e.status?console.log(i,"set error:",e):r.prop("checked",n)}})}),r}function makequestcheckbox(e,s,t,i){var r=$('<input type="checkbox" />');return r.prop("disabled",e),r.prop("checked",s[t]),r.click(function(e){var n=r.prop("checked");e.preventDefault(),confirm(`确定将问题${s.id}的'${i}'设为${n}吗?`)&&$.ajax({async:!0,url:"/web/quest/info/"+s.id+"/set",type:"POST",data:`{"${t}":${n}}`,success:function(e){"ok"!==e.status?console.log(i,"set error:",e):r.prop("checked",n)}})}),r}function makematchcheckbox(e,s,t,i){var r=$('<input type="checkbox" />');return r.prop("disabled",e),r.prop("checked",s[t]),r.click(function(e){var n=r.prop("checked");e.preventDefault(),confirm(`确定将比赛${s.id}的'${i}'设为${n}吗?`)&&$.ajax({async:!0,url:"/web/quest/matchinfo/"+s.id+"/set",type:"POST",data:`{"${t}":${n}}`,success:function(e){"ok"!==e.status?console.log(i,"set error:",e):r.prop("checked",n)}})}),r}function flushUser(e){const s=$("#user-verifies-body"),t=e.auths;$("#user-verifies").show(),$.ajax({url:"/web/user/myinfo/children",type:"GET",success:function(e){"ok"===e.status?(s.html(""),e.data.children.sort().forEach(e=>{var i=$('<div class="user-verifies-item">\n\t<span class="user-verifies-item-id"></span>\n\t<span class="user-verifies-item-name"></span>\n\t<span class="user-verifies-item-status"></span>\n\t<span class="user-verifies-item-verified"></span>\n\t<span class="user-verifies-item-v_user"></span>\n\t<span class="user-verifies-item-v_quest"></span>\n\t<span class="user-verifies-item-c_match"></span>\n</div>');s.append(i),$.ajax({url:"/web/user/info/"+e+"/info",type:"GET",success:function(e){if("ok"!==e.status)return;const s=e.data;i.children(".user-verifies-item-id:first").text(s.userid),i.children(".user-verifies-item-name:first").text(s.username),i.children(".user-verifies-item-status:first").text(s.frozen?"冻结":"正常"),i.children(".user-verifies-item-verified:first").html(makeusercheckbox(!1,s,"verified","已验证")),i.children(".user-verifies-item-v_user:first").html(makeusercheckbox(!t.v_user,s,"op_v_user","允许验证用户")),i.children(".user-verifies-item-v_quest:first").html(makeusercheckbox(!t.v_quest,s,"op_v_quest","允许审核问题")),i.children(".user-verifies-item-c_match:first").html(makeusercheckbox(!t.c_match,s,"op_c_match","允许创建比赛"))}})})):console.log("error res:",e)}})}function flushQuest(e){const s=$("#quest-verifies-body"),t=e.auths;$("#quest-verifies").show(),$.ajax({url:"/web/quest/list",type:"GET",success:function(e){"ok"===e.status?(s.html(""),e.data.sort((e,s)=>e.id-s.id).forEach(e=>{var i=$('<div class="quest-verifies-item">\n\t<span class="quest-verifies-item-id"></span>\n\t<span class="quest-verifies-item-user"></span>\n\t<span class="quest-verifies-item-quest"></span>\n\t<span class="quest-verifies-item-answer"></span>\n\t<span class="quest-verifies-item-verified"></span>\n\t<span class="quest-verifies-item-delete"></span>\n</div>');s.append(i),i.children(".quest-verifies-item-id:first").text(e.id),$.ajax({url:"/web/user/info/"+e.owner+"/info",type:"GET",success:function(e){"ok"!==e.status||i.children(".quest-verifies-item-user:first").text(e.data.username)}});let r=i.children(".quest-verifies-item-quest:first");r.html(""),e.quest.split("\n").forEach(e=>{r.append($("<p></p>").text(e))}),i.children(".quest-verifies-item-answer:first").text(e.answer),i.children(".quest-verifies-item-verified:first").html(makequestcheckbox(!t.v_quest,e,"verified","已验证")),i.children(".quest-verifies-item-delete:first").html($('<input type="button" value="删除" />').click(function(){confirm(`确认删除问题${e.id}吗?`)&&$.ajax({url:"/web/quest/info/"+e.id+"/set",type:"POST",data:JSON.stringify({delete:!0}),success:function(e){"ok"!==e.status?console.log("remove error:",e):i.remove()}})}))})):console.log("error res:",e)}})}function flushMatch(e){const s=$("#match-list-body"),t=e.auths;$("#match-list").show(),$.ajax({url:"/web/quest/matchlist",type:"GET",success:function(e){"ok"===e.status?(s.html(""),e.data.forEach(e=>{var i=$('<div class="match-list-item">\n\t<span class="match-list-item-id"></span>\n\t<span class="match-list-item-questnum"></span>\n\t<span class="match-list-item-using"></span>\n\t<span class="match-list-item-joined"></span>\n\t<span class="match-list-item-delete"></span>\n\t<span class="match-list-item-search"></span>\n</div>');s.append(i),i.children(".match-list-item-id:first").text(e.id),i.children(".match-list-item-questnum:first").text(e.questnum),i.children(".match-list-item-using:first").html(makematchcheckbox(!t.c_match,e,"using","启用")),i.children(".match-list-item-joined:first").text(e.joined),i.children(".match-list-item-delete:first").html($('<input type="button" value="删除" />').click(function(){confirm(`确认删除比赛${e.id}吗?`)&&$.ajax({url:"/web/quest/matchinfo/"+e.id+"/set",type:"POST",data:JSON.stringify({delete:!0}),success:function(e){"ok"!==e.status?console.log("remove error:",e):i.remove()}})})),i.children(".match-list-item-search:first").html($('<input type="button" value="查看" />').click(function(){window.location="/web/quest/matchuserlist/"+e.id}))})):console.log("error res:",e)}})}$(document).ready(function(){var e=null,s=null;$.ajax({url:"/web/user/myinfo/auth",type:"GET",success:function(t){if("ok"===t.status)return e=t.data,s=e.auths,$("#user-info-name").text(e.username),Object.keys(s).forEach(e=>{$("#user-info-auth").append($('<span class="user-info-auth-line"></span>').text(e+":"+s[e]))}),s.v_user&&flushUser(e),s.v_quest&&flushQuest(e),void(s.c_match&&(flushMatch(e),$("#match-list-create-btn>input:first").click(function(){var s=Number.parseInt($("#match-list-create-questnum>input:first").val());s<=0&&(s=1);var t=$("#match-list-create-using>input:first").prop("checked");$.ajax({url:"/web/quest/matchcreate",type:"POST",data:{questnum:s,using:t},success:function(s){"ok"!==s.status?console.log("error res:",s):flushMatch(e)}})})))}}),$("#user-verifies-flush-btn").click(function(){flushUser(e)}),$("#quest-verifies-flush-btn").click(function(){flushQuest(e)}),$("#match-list-flush-btn").click(function(){flushMatch(e)})});