function nextquestion(){const e=$("#answer-text"),t=$("#question-body-text"),o=e.val();$.ajax({url:"/web/quest/match/getnext",type:"POST",data:{answer:o},success:function(o){if("ok"===o.status)return e.val(""),$("#quest-count").text(o.count+"/"+o.max_count),void $.ajax({url:"/web/quest/search",type:"POST",data:{id:o.questid},success:function(e){if("ok"===e.status){const o=e.data;return t.html(""),o.quest.split("\n").forEach(e=>{t.append($('<div class="question-body-text-line"></div>').text(e))}),void $.ajax({url:"/web/user/info/"+o.owner+"/info",type:"GET",success:function(e){if("ok"!==e.status);else{const t=e.data;$("#question-body-info-owner").text(t.username)}}})}console.log("error res:",e)}});if(void 0===o.error)console.log("res:",o);else{switch(o.error){case"ParseJWTError":alert("获取问题失败: "+o.errorMessage),window.location="/web/quest/match";break;case"FinishedMatch":return console.log("finished"),void $.ajax({url:"/web/quest/match/submit",type:"POST",success:function(e){if("ok"===e.status)return alert("答卷提交完毕"),void(window.location="/web/quest/matchcheck?muserid="+e.muserid);void 0===e.error||alert("提交答卷错误: "+e.errorMessage)}})}console.log("error:",o)}}})}$(document).ready(function(){$.ajax({url:"/web/user/myinfo/info",type:"GET",success:function(e){if("ok"!==e.status)return alert("您需要先去登录"),void(window.location="/web/user/login")}}),$("#start_page").show(),$("#start-btn").click(function(){const e=$("#matchid-input").val();0!==e.length?$.ajax({url:"/web/quest/match/prepare",type:"POST",data:{matchid:e},success:function(t){if("ok"===t.status)return console.log("prepare '"+e+"' successed"),$("#start_page").hide(),$("#match_page").show(),void nextquestion();if(void 0===t.error)console.log("res:",t);else switch(t.error){case"UserNotLogin":return alert("您需要先去登录"),void(window.location="/web/user/login");case"UserPrepared":return $("#start_page").hide(),$("#match_page").show(),void nextquestion();case"NoMatchForUser":alert("没有匹配的竞赛");break;default:console.log("error:",t)}}}):alert("match id error")}),$("#submit-btn").click(nextquestion),$("#answer-text").keydown(function(e){"Enter"!=e.key&&13!=e.keyCode||(e.preventDefault(),$("#submit-btn").click())})});