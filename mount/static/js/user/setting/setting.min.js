const pwdreg=/^[A-Za-z][0-9A-Za-z_-]{7,127}$/;var userdata=null;function updateUserdata(){userdata?($("#user-info-head-img").prop("src","/web/user/info/"+userdata.userid+"/head"),$("#user-info-name-cont").text(userdata.username),$("#user-info").show()):$("#user-info").hide()}$(document).ready(function(){$.ajax({url:"/web/user/myinfo/info",type:"GET",success:function(e){return void 0!==e.error?(alert("您还没有登录，请先登录"),void(window.location="/web/user/login")):"ok"===e.status&&void 0!==e.data?(userdata=e.data,void updateUserdata()):void 0}}),$("#user-info-head-choose-file").bind("change",function(){if(0==this.files.length)return;const e=this.files[0];if(e.size>262144)alert("头像大小不能大于256Kb");else{var s=new FileReader;s.onload=function(){var e=this.result;$("#user-info-head-img").prop("src",e),$("#user-info-head-sure").show()},s.readAsDataURL(e)}}),$("#user-info-head-sure").click(function(){const e=$("#user-info-head-img").prop("src");$.ajax({url:"/web/user/setting/set/head",type:"POST",data:{imgdata:e},success:function(e){console.log("res:",e)}}),$(this).hide()}),$("#user-info-head-choose-btn").click(function(){$("#user-info-head-choose-file").click()}),$("#user-info-changepwd-button").click(function(){const e=$("#user-info-changepwd-originalpwd").val(),s=$("#user-info-changepwd-newpwd").val(),a=$("#user-info-changepwd-repeatnewpwd").val();pwdreg.test(e)&&pwdreg.test(s)&&pwdreg.test(a)?s===a?$.ajax({url:"/web/user/setting/set/password",type:"POST",data:{oldpwd:e,newpwd:s},success:function(e){void 0===e.error?"ok"!==e.status||alert("密码修改成功"):alert("设置密码错误: "+e.errorMessage)}}):alert("两次密码不一致"):alert("不是合法密码")})});