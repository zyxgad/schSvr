const namereg=/^[A-Za-z_-][0-9A-Za-z_-]{3,31}$/,pwdreg=/^[A-Za-z][0-9A-Za-z_-]{7,127}$/;function shakeBox(e){e.removeClass("animation-shake-time3"),setTimeout(()=>{e.addClass("animation-shake-time3")},10)}function updateCaptcha(){$.ajax({url:"/web/user/captcha/image",type:"GET",success:function(e){"ok"===e.status&&void 0!==e.data&&$("#register-box-captcha-img").prop("src",e.data)}})}$(document).ready(function(){function e(){const e=$("#register-box-username-input").val(),r=$("#register-box-username-error");return namereg.test(e)?(r.hide(),r.text(""),!0):(r.text("用户名需以字母或'_'开头,仅能含有数字/字母/'_',长度4-32"),r.show(),shakeBox(r),!1)}function r(){const e=$("#register-box-password-input").val(),r=$("#register-box-password-error");return pwdreg.test(e)?(r.hide(),r.text(""),!0):(r.text("密码需以字母开头,仅能含有数字/字母/'_',长度8-128"),r.show(),shakeBox(r),!1)}function t(){const e=$("#register-box-manager-input").val(),r=$("#register-box-manager-error");return namereg.test(e)?(r.hide(),r.text(""),!0):(r.text("不是合法用户名"),r.show(),shakeBox(r),!1)}function a(){const e=$("#register-box-captcha-input").val(),r=$("#register-box-captcha-error");return""===e?(r.text("请输入验证码"),r.show(),shakeBox(r),!1):(r.hide(),r.text(""),!0)}updateCaptcha(),$("#register-box-username-input").blur(e),$("#register-box-password-input").blur(r),$("#register-box-pwdagain-input").blur(function(){if(!r())return!1;const e=$("#register-box-password-input").val(),t=$("#register-box-pwdagain-input").val(),a=$("#register-box-pwdagain-error");return e!==t?(a.text("两次密码不一致"),a.show(),shakeBox(a),!1):(a.hide(),a.text(""),!0)}),$("#register-box-manager-input").blur(t),$("#register-box-captcha-input").blur(a),$("#register-box-captcha-img").click(updateCaptcha),$("#register-box-submit").keydown(function(e){"Enter"!=e.key&&13!=e.keyCode||e.preventDefault()}),$("#register-box-submit").click(function(){let o=e(),s=r(),i=t(),n=a();if(!(o&&s&&i&&n))return;const u=$("#register-box-username-input").val(),c=$("#register-box-password-input").val(),x=$("#register-box-manager-input").val(),g=$("#register-box-captcha-input").val(),p=$("#register-box-error");$.ajax({url:"/web/user/register",type:"POST",data:{username:u,password:c,manager:x,captcode:g},success:function(e){if("ok"===e.status)return console.log("register success"),p.hide(),p.text(""),alert("已向管理员提交申请"),void(window.location="/web/redirectto?url=/web/user/login");if(void 0===e.error)console.log("error res:",e);else{switch(e.error){case"CaptchaError":let r=$("#register-box-captcha-error");r.text("验证码错误"),r.show(),shakeBox(r);break;default:p.text(e.errorMessage),p.show(),shakeBox(p)}updateCaptcha()}}})}),$("#register-box").keyup(function(e){"Enter"!=e.key&&13!=e.keyCode||$("#register-box-submit").click()})});