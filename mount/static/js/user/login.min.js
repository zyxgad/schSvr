const namereg=/^[A-Za-z_-][0-9A-Za-z_-]{3,31}$/,pwdreg=/^[A-Za-z][0-9A-Za-z_-]{7,127}$/;function shakeBox(o){o.removeClass("animation-shake-time3"),setTimeout(()=>{o.addClass("animation-shake-time3")},10)}function updateCaptcha(){$.ajax({url:"/web/user/captcha/image",type:"GET",success:function(o){"ok"===o.status&&void 0!==o.data&&$("#login-box-captcha-img").prop("src",o.data)}})}$(document).ready(function(){function o(){const o=$("#login-box-username-input").val(),e=$("#login-box-username-error");return namereg.test(o)?(e.hide(),e.text(""),!0):(e.show(),e.text("不是合法用户名"),shakeBox(e),!1)}function e(){const o=$("#login-box-password-input").val(),e=$("#login-box-password-error");return pwdreg.test(o)?(e.hide(),e.text(""),!0):(e.show(),e.text("不是合法密码"),shakeBox(e),!1)}function t(){const o=$("#login-box-captcha-input").val(),e=$("#login-box-captcha-error");return""===o?(e.text("请输入验证码"),e.show(),shakeBox(e),!1):(e.hide(),e.text(""),!0)}updateCaptcha(),$("#login-box-username-input").blur(o),$("#login-box-password-input").blur(e),$("#login-box-captcha-input").blur(t),$("#login-box-captcha-img").click(updateCaptcha),$("#login-box-submit").keydown(function(o){"Enter"!=o.key&&13!=o.keyCode||o.preventDefault()}),$("#login-box-submit").click(function(){let a=o(),n=e(),r=t();if(!a||!n||!r)return;const i=$("#login-box-username-input").val(),s=$("#login-box-password-input").val(),c=$("#login-box-captcha-input").val(),u=$("#login-box-error");$.ajax({url:"/web/user/login",type:"POST",data:{username:i,password:s,captcode:c},success:function(o){if("ok"===o.status)return console.log("login success"),u.hide(),u.text(""),void(window.location="/web/redirectto?url=/web");if(void 0===o.error)console.log("error res:",o);else{switch(o.error){case"CaptchaError":let e=$("#login-box-captcha-error");e.text("验证码错误"),e.show(),shakeBox(e);break;case"UserNotVerifyException":u.text("请等待管理员审核"),u.show(),shakeBox(u);break;default:u.text(o.errorMessage),u.show(),shakeBox(u)}updateCaptcha()}}})}),$("#login-box").keyup(function(o){"Enter"!=o.key&&13!=o.keyCode||$("#login-box-submit").click()})});